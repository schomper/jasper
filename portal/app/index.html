<!DOCTYPE html>
<html ng-app="portalApp">
    <head>
        <meta charset="utf-8">
        <title>Portal</title>
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
        <script src="http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.10/angular.min.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.10/angular-route.min.js"></script>
        <script src="../node_modules/angular-bootstrap/ui-bootstrap.js"></script>
        <script src="../node_modules/angular-bootstrap/ui-bootstrap-tpls.min.js"></script>

        <script src="app.js"></script>
        <script>


            /* Create our own dependancy injection          *
             * removes the need to load data multiple times */
            portalApp.factory('articles', function($http){

                function getData(callback) {
                    $http({
                        method: 'GET',
                        url: 'document_list.json',
                        cache: true
                    }).success(callback);
                }

                return {
                    list: getData,
                    find: function(name, callback) {
                        getData(function(data) {
                            var article = data.filter(function(entry){
                                return entry.name === name;
                            })[0];
                            callback(article);
                        });
                    }
                };
            });

            portalApp.factory('topics', function($http){

                function getData(callback) {
                    $http({
                        method: 'GET',
                        url: 'topics_and_words.json',
                        cache: true
                    }).success(callback);
                }

                return {
                    list: getData,
                    find: function(name, callback) {
                        getData(function(data) {
                            var topic = data.filter(function(entry){
                                return entry.name === name;
                            })[0];
                            callback(topic);
                        });
                    }
                };
            });

            portalApp.controller('ArticleListCtrl', function($scope, articles) {
                $scope.totalDisplayed = 20;

                articles.list(function(articles) {
                    $scope.articles = articles.articles;
                });

                $scope.loadMore = function() {
                  $scope.totalDisplayed += 20;
                };
            });

            portalApp.controller('TopicInfoCtrl', function($scope, topics) {
                topics.list(function(topics) {
                    $scope.topics = topics;
                });

                // $scope.setTopicName = function(index) {
                //   console.log($scope.topics[index].letters);
                //   console.log('Click index ' + index);
                //   $scope.topics[index].letters = 'Timothy';
                //   console.log($scope.topics[index]);
                //   console.log($scope.topics[index].letters);
                // };

                $scope.$watch('numWords', function(newValue, oldValue){
                  console.log('new value is ' + newValue);
                });


            });

        </script>
    </head>

    <body>
        <div ng-view></div>
    </body>
</html>
